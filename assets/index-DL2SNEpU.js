(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();const _="https://ttt-mauve-rho.vercel.app",m=_,D={animekai:{base:m+"/anime/animekai",templates:{search:m+"/anime/animekai/{query}",info:m+"/anime/animekai/info?id={id}",episodes:m+"/anime/animekai/episodes/{id}",watch:m+"/anime/animekai/watch/{episodeId}"}},animepahe:{base:m+"/anime/animepahe",templates:{search:m+"/anime/animepahe/{query}",info:m+"/anime/animepahe/info/{id}",episodes:m+"/anime/animepahe/episodes/{id}",watch:m+"/anime/animepahe/watch?episodeId={episodeId}"}},"hianime-scrap":{base:"https://api.animo.qzz.io/api/v1",templates:{search:"https://api.animo.qzz.io/api/v1/search?keyword={query}&page=1",info:"https://api.animo.qzz.io/api/v1/animes/{id}",episodes:"https://api.animo.qzz.io/api/v1/episodes/{id}",servers:"https://api.animo.qzz.io/api/v1/servers?id={id}",stream:"https://api.animo.qzz.io/api/v1/stream?id={id}&type={type}&server={server}"}}},M="https://renewed-georgeanne-nekonode-1aa70c0c.koyeb.app";function y(e,n,r={}){const s=D[e];if(!s)return console.error(`Provider ${e} not found`),"";const t=s.templates[n];if(!t)return console.error(`Template ${n} not found for provider ${e}`),"";let o=t;return Object.keys(r).forEach(i=>{let a=r[i];i==="episodeId"?a=encodeURIComponent(a):a!=null?a=encodeURIComponent(String(a)):a="",o=o.replace(new RegExp(`\\{${i}\\}`,"g"),a)}),o}async function g(e,n={}){try{const r=await fetch(e,{...n,headers:{Accept:"application/json","Content-Type":"application/json",...n.headers}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error(`Fetch error for ${e}:`,r),r}}document.getElementById("app");const P=document.getElementById("searchInput"),N=document.getElementById("searchBtn"),H=document.getElementById("providerSelect"),L=document.getElementById("results"),$=document.getElementById("details"),T=document.getElementById("episodes"),f=document.getElementById("servers");let R={};async function U(){const e=P.value.trim();if(!e){alert("Please enter a search query");return}const n=H.value;try{L.innerHTML="<p>Searching...</p>";const r=y(n,"search",{query:e});console.log("Search URL:",r);const s=await g(r);let t=[];if(s&&s.data&&s.data.response&&Array.isArray(s.data.response)?t=s.data.response:Array.isArray(s)?t=s:s&&s.results&&Array.isArray(s.results)?t=s.results:s&&s.anime&&Array.isArray(s.anime)?t=s.anime:s&&s.data&&Array.isArray(s.data)&&(t=s.data),t.length===0){L.innerHTML="<p>No results found. Try a different search term.</p>";return}C(t)}catch(r){console.error("Search error:",r),L.innerHTML=`<p class="error">Search failed: ${r.message}. Check your connection and try again.</p>`}}function C(e){R={},L.innerHTML=e.map(n=>{const r=n.title||n.name||n.englishName||"Unknown Title",s=n.id||n.animeId||n.mal_id||"",t=n.image||n.poster||n.coverImage||"https://via.placeholder.com/150x200",o=n.releaseDate||n.year||n.startDate||"N/A";let i="";if(n.episodes)if(typeof n.episodes=="object"){const h=n.episodes.sub||0,p=n.episodes.dub||0,l=n.episodes.eps||0;h>0||p>0?i=`<p>${h>0?`Sub: ${h}`:""}${h>0&&p>0?" | ":""}${p>0?`Dub: ${p}`:""}</p>`:l>0&&(i=`<p>Episodes: ${l}</p>`)}else i=`<p>Episodes: ${n.episodes}</p>`;const a=n.type?`<p>${n.type}</p>`:"",c=n.duration?`<p>${n.duration}</p>`:"";return H.value==="hianime-scrap"?(R[s]=n,`
        <div class="anime-card" onclick="selectAnime('${s.replace(/'/g,"\\'")}')">
          <img src="${t}" alt="${r}" loading="lazy">
          <h3>${r}</h3>
          ${i}
          ${a}
          ${c}
          <p>${o}</p>
        </div>
      `):`
      <div class="anime-card" onclick="selectAnime('${s.replace(/'/g,"\\'")}', '${r.replace(/'/g,"\\'")}')">
        <img src="${t}" alt="${r}" loading="lazy">
        <h3>${r}</h3>
        ${i}
        ${a}
        ${c}
        <p>${o}</p>
      </div>
    `}).join("")}async function j(e,n){var o,i,a,c,d,h;if(!e){alert("Invalid anime ID");return}const r=H.value,s=r==="hianime-scrap",t=s?R[e]:null;try{if($.innerHTML="<p>Loading details...</p>",s&&t){const u={...t,id:t.id||e,__provider:r};try{const S=y(r,"episodes",{id:e});console.log("Episodes URL:",S);const E=await g(S);if(u.episodes=I(E,r),u.episodes.length>0){A(u,t.title);return}}catch(S){console.warn("Could not fetch episodes for hianime-scrap:",S)}const b=((o=u.episodes)==null?void 0:o.eps)||((i=u.episodes)==null?void 0:i.sub)||((a=u.episodes)==null?void 0:a.dub)||((c=u.episodes)==null?void 0:c.total)||((d=u.episodes)==null?void 0:d.episodeCount)||((h=u.episodes)==null?void 0:h.totalEpisodes)||0;b>0?(u.episodes=Array.from({length:Math.min(b,500)},(S,E)=>({id:`${e}::ep=${E+1}`,number:E+1,title:`Episode ${E+1}`,isFiller:!1})),console.log(`Generated ${b} episode buttons from count`)):u.episodes=[],A(u,t.title);return}const p=typeof n=="string"?n:null,l=y(r,"info",{id:e});console.log("Info URL:",l);const v=await g(l);let w=z(v,e,r);if(!w.episodes||w.episodes.length===0)try{const u=y(r,"episodes",{id:e});console.log("Episodes URL:",u);const b=await g(u);w.episodes=I(b,r)}catch(u){console.warn("Could not fetch episodes separately:",u),w.episodes=[]}w.__provider=r,A(w,p||w.title)}catch(p){console.error("Details error:",p),$.innerHTML=`<p class="error">Error loading anime details: ${p.message}</p>`}}function z(e,n,r){var s,t,o;if(e&&e.data&&r==="hianime-scrap")return{...e.data,id:e.data.id||n,title:e.data.title,poster:e.data.poster,image:e.data.poster,type:e.data.type,status:e.data.status,genres:e.data.genres||[],description:e.data.description||e.data.synopsis||"",totalEpisodes:((s=e.data.episodes)==null?void 0:s.eps)||((t=e.data.episodes)==null?void 0:t.sub)||((o=e.data.episodes)==null?void 0:o.dub)||"Unknown"};if(Array.isArray(e)){const i=e.find(a=>a&&a.id===n)||e[0];return i?{...i,id:i.id||n}:{id:n,episodes:[]}}if(e&&e.results&&Array.isArray(e.results)){const i=e.results.find(a=>a&&a.id===n)||e.results[0];return i?{...i,id:i.id||n}:{...e,id:e.id||n}}return e&&e.data?{...e.data,id:e.data.id||n}:e&&(e.title||e.name||e.englishName)?{...e,id:e.id||n}:{id:n,...e||{}}}function I(e,n){return e?n==="hianime-scrap"&&e&&e.data&&Array.isArray(e.data)?e.data.map((r,s)=>({id:r.id||`${s+1}`,number:r.episodeNumber||s+1,title:r.title||r.alternativeTitle||`Episode ${r.episodeNumber||s+1}`,isFiller:r.isFiller||!1})):Array.isArray(e)?e.map((r,s)=>({id:r.id||r.episodeId||`${s+1}`,number:r.number||r.episode||r.ep||s+1,title:r.title||r.name||`Episode ${s+1}`})):e.episodes&&Array.isArray(e.episodes)?e.episodes.map((r,s)=>({id:r.id||r.episodeId||`${s+1}`,number:r.number||r.episode||r.ep||s+1,title:r.title||r.name||`Episode ${s+1}`})):e.data&&Array.isArray(e.data)?e.data.map((r,s)=>({id:r.id||r.episodeId||`${s+1}`,number:r.number||r.episode||r.ep||s+1,title:r.title||r.name||`Episode ${s+1}`})):[]:[]}async function B(e,n){if(!e){alert("Invalid episode ID");return}const r=H.value;try{if(f.innerHTML="<p>Loading servers...</p>",r==="hianime-scrap"){let o=e,i=n;const a=e.match(/::ep=(\d+)$/);a&&(i=a[1],console.log(`Episode ${i} selected (ID: ${e})`));const c=y(r,"servers",{id:e});console.log("Servers URL:",c);const d=await g(c);q(d,i||n||"1",e);return}if(r==="animepahe"){const o=y(r,"watch",{episodeId:e});console.log("Watch URL:",o);const i=await g(o);k(i,n||"1");return}if(r==="animekai"){const o=y(r,"watch",{episodeId:e});console.log("Watch URL:",o);const i=await g(o);k(i,n||"1");return}const s=y(r,"servers",{id:e});console.log("Servers URL:",s);const t=await g(s);k(t,n||"1")}catch(s){console.error("Servers error:",s),f.innerHTML=`<p class="error">Error loading servers: ${s.message}. Try a different episode.</p>`}}window.selectAnime=j;window.selectEpisode=B;function A(e,n){var p;console.log("Displaying anime details:",e);const r=e.title||n||"Unknown Title",s=e.image||e.poster||e.coverImage||"https://via.placeholder.com/200x300",t=e.japaneseTitle||e.jname||"",o=e.type||e.format||"Unknown",i=e.status||"",a=e.genres||(e.genre?[e.genre]:[]),c=e.totalEpisodes||e.episodeCount||((p=e.episodes)==null?void 0:p.length)||"Unknown",d=e.description||e.synopsis||"No description available",h=e.url||e.animeUrl||"";$.innerHTML=`
    <div class="anime-details">
      <div class="anime-header">
        <img src="${s}" alt="${r}" onerror="this.src='https://via.placeholder.com/200x300'">
        <div class="anime-info">
          <h2>${r}</h2>
          ${t?`<p><strong>Japanese:</strong> ${t}</p>`:""}
          <p><strong>Type:</strong> ${o}</p>
          ${i?`<p><strong>Status:</strong> ${i}</p>`:""}
          ${a.length>0?`<p><strong>Genres:</strong> ${a.join(", ")}</p>`:""}
          <p><strong>Episodes:</strong> ${c}</p>
          <p><strong>Description:</strong> ${d}</p>
          ${h?`<p><a href="${h}" target="_blank" rel="noopener noreferrer" class="watch-link">View on Provider â†’</a></p>`:""}
        </div>
      </div>
    </div>
  `,$.scrollIntoView({behavior:"smooth"}),e.episodes&&e.episodes.length>0?(e.episodes,F(e.episodes)):T.innerHTML="<p>No episodes available</p>",f.innerHTML=""}function F(e){T.innerHTML="<h3>Episodes</h3>";const n=e.map((r,s)=>{const t=r.number||r.episode||r.ep||s+1,o=r.title||r.name||"",i=r.id||`${s+1}`,a=r.isFiller,c=a?'<span style="color:#ffcc00;font-size:0.7em;"> â˜…Filler</span>':"";return`
      <button 
        class="episode-btn ${a?"filler":""}" 
        onclick="selectEpisode('${String(i).replace(/'/g,"\\'")}', '${t}')"
        title="${o}${a?" (Filler)":""}"
      >
        ${t}${c}
        ${o?`<br><small style="font-size:0.7em">${o.substring(0,20)}${o.length>20?"...":""}</small>`:""}
      </button>
    `}).join("");T.innerHTML+=`<div class="episodes-grid">${n}</div>`}function q(e,n,r){if(f.innerHTML=`<h3>Servers for Episode ${n}</h3>`,!e||!e.success||!e.data){f.innerHTML+="<p>No servers available for this episode. Try a different episode.</p>";return}const s=e.data,t=s.sub||[],o=s.dub||[],i=s.raw||[];if(t.length===0&&o.length===0&&i.length===0){f.innerHTML+="<p>No servers available for this episode. Try a different episode.</p>";return}window.hianimeScrapServerData={episodeId:r,sub:t,dub:o,raw:i};let a='<div class="servers-tabs">';a+=`<div class="server-tab ${t.length>0?"active":""}" onclick="showHianimeScrapServers('sub')">Sub (${t.length})</div>`,a+=`<div class="server-tab ${t.length===0&&o.length>0?"active":""}" onclick="showHianimeScrapServers('dub')">Dub (${o.length})</div>`,a+=`<div class="server-tab ${t.length===0&&o.length===0&&i.length>0?"active":""}" onclick="showHianimeScrapServers('raw')">Raw (${i.length})</div>`,a+="</div>",a+='<div id="hianimeScrapServersList" class="servers-list"></div>',f.innerHTML+=a,t.length>0?showHianimeScrapServers("sub"):o.length>0?showHianimeScrapServers("dub"):showHianimeScrapServers("raw")}window.showHianimeScrapServers=function(e){const n=document.getElementById("hianimeScrapServersList");if(!n||!window.hianimeScrapServerData)return;document.querySelectorAll(".server-tab").forEach(s=>{s.classList.remove("active"),s.textContent.toLowerCase().includes(e)&&s.classList.add("active")});const r=window.hianimeScrapServerData[e]||[];if(r.length===0){n.innerHTML=`<p>No ${e} servers available.</p>`;return}n.innerHTML=r.map(s=>{const t=s.name||`Server ${s.index||""}`,o=s.id,i=e;return`
      <div class="server-option">
        <strong>${t}</strong>
        <p>Type: ${i.charAt(0).toUpperCase()+i.slice(1)}</p>
        <p><button class="play-btn" onclick="playHianimeScrapStream('${o}', '${i}', '${t.replace(/'/g,"\\'")}')">â–¶ Play</button></p>
      </div>
    `}).join("")};window.playHianimeScrapStream=async function(e,n,r){if(!window.hianimeScrapServerData)return alert("No server data available");const s=window.hianimeScrapServerData.episodeId,t=y("hianime-scrap","stream",{id:s,type:n,server:r});console.log("Stream URL:",t);try{f.innerHTML="<p>Loading stream...</p>";const o=await g(t);o&&o.success&&o.data?x(o.data,r):f.innerHTML='<p class="error">Failed to load stream. Try a different server.</p>'}catch(o){console.error("Stream error:",o),f.innerHTML=`<p class="error">Error loading stream: ${o.message}</p>`}};function x(e,n){var h,p;const r=((h=e.link)==null?void 0:h.file)||((p=e.link)==null?void 0:p.directUrl)||"",s=e.tracks||[],t=e.intro||{start:0,end:0},o=e.outro||{start:0,end:0};if(!r){f.innerHTML='<p class="error">No video URL available</p>';return}let i=document.getElementById("videoPlayer");i||(i=document.createElement("div"),i.id="videoPlayer",i.style.marginBottom="20px",f.prepend(i));let a="";s.length>0&&(a=s.map(l=>l.kind==="captions"||l.kind==="subtitles"?`<track label="${l.label}" kind="${l.kind}" src="${l.file}" ${l.default?"default":""}>`:"").join(""));let c="";(t.start!==0||t.end!==0)&&(c+=`<p style="color:#ffcc00;">Skip intro: ${t.start}s - ${t.end}s</p>`),(o.start!==0||o.end!==0)&&(c+=`<p style="color:#ffcc00;">Skip outro: ${o.start}s - ${o.end}s</p>`),i.innerHTML=`
    <h3>Now Playing: ${n}</h3>
    <video id="animeVideo" controls style="width:100%; max-height:60vh; background:#000; border-radius:8px;" crossorigin="anonymous">
      <source src="${r}" type="application/vnd.apple.mpegurl">
      ${a}
    </video>
    ${c}
    <p style="margin-top:10px; font-size:0.9em; color:var(--text-light);">
      <a href="${r}" target="_blank" rel="noopener noreferrer">Open video in new tab</a> | 
      <a href="#" onclick="location.reload(); return false;">Refresh player</a>
    </p>
  `;const d=document.getElementById("animeVideo");if(s.length>0&&s.forEach(l=>{if(l.kind==="captions"||l.kind==="subtitles"){const v=d.textTracks[0];v&&(v.mode=l.default?"showing":"hidden")}}),d.canPlayType("application/vnd.apple.mpegurl")){d.src=r,d.play().catch(l=>{console.warn("Auto-play prevented:",l)});return}V(d,r)}function V(e,n){try{if(window.Hls)O(e,n);else{const r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12/dist/hls.min.js",r.onload=()=>O(e,n),r.onerror=()=>{console.error("Failed to load HLS.js"),window.open(n,"_blank")},document.head.appendChild(r)}}catch(r){console.warn("HLS playback failed:",r),window.open(n,"_blank")}}function O(e,n){if(!window.Hls)return;const r=new window.Hls({enableWorker:!0,lowLatencyMode:!0});r.loadSource(n),r.attachMedia(e),r.on(window.Hls.Events.MANIFEST_PARSED,()=>{e.play().catch(s=>{console.warn("Auto-play prevented:",s)})}),r.on(window.Hls.Events.ERROR,(s,t)=>{if(console.error("HLS error:",t),t.fatal)switch(t.type){case window.Hls.ErrorTypes.NETWORK_ERROR:r.startLoad();break;case window.Hls.ErrorTypes.MEDIA_ERROR:r.recoverMediaError();break;default:window.open(n,"_blank");return}})}function k(e,n){f.innerHTML=`<h3>Servers for Episode ${n}</h3>`;let r=[];if(Array.isArray(e)?r=e:e&&e.servers&&Array.isArray(e.servers)?r=e.servers:e&&e.sources&&Array.isArray(e.sources)?r=e.sources:e&&e.data&&Array.isArray(e.data)?r=e.data:e&&e.streamingServers&&Array.isArray(e.streamingServers)&&(r=e.streamingServers),r.length===0){f.innerHTML+="<p>No servers available for this episode. Try a different episode.</p>";return}let s='<div class="servers-list">';r.forEach((t,o)=>{const i=t.name||t.serverName||t.quality||`Server ${o+1}`,a=t.url||t.file||t.src||t.streamUrl||"";if(s+=`
      <div class="server-option">
        <strong>${i}</strong>
    `,a){const c=`${M}/fetch?url=${encodeURIComponent(a)}`;s+=`
        <p><a href="${a}" target="_blank" rel="noopener noreferrer">Open Original</a></p>
        <p><a href="${c}" target="_blank" rel="noopener noreferrer">Open via Proxy</a></p>
        <p><button class="play-btn" onclick="playStream('${c.replace(/'/g,"\\'")}', '${i.replace(/'/g,"\\'")}')">â–¶ Play</button></p>
      `,t.sources&&Array.isArray(t.sources)&&t.sources.forEach((d,h)=>{const p=d.url||d.file||d.src||"";if(p){const l=`${M}/fetch?url=${encodeURIComponent(p)}`,v=d.quality||`Source ${h+1}`;s+=`
              <hr style="margin: 10px 0; border-color: rgba(233,69,96,0.3);">
              <p><strong>${v}</strong></p>
              <p><a href="${p}" target="_blank" rel="noopener noreferrer">Open Original</a></p>
              <p><a href="${l}" target="_blank" rel="noopener noreferrer">Open via Proxy</a></p>
              <p><button class="play-btn" onclick="playStream('${l.replace(/'/g,"\\'")}', '${v.replace(/'/g,"\\'")}')">â–¶ Play</button></p>
            `}})}else s+="<p>No direct URL available</p>";(t.intro||t.outro)&&(s+='<p class="meta">',t.intro&&(s+=`Intro: ${t.intro.start}-${t.intro.end}s `),t.outro&&(s+=`Outro: ${t.outro.start}-${t.outro.end}s`),s+="</p>"),s+="</div>"}),s+="</div>",f.innerHTML+=s}window.playStream=async function(e,n){if(!e)return alert("No stream URL available");console.log("Playing stream:",e);let r=document.getElementById("videoPlayer");r||(r=document.createElement("div"),r.id="videoPlayer",r.style.marginBottom="20px",f.prepend(r)),r.innerHTML=`
    <h3>Now Playing: ${n}</h3>
    <video id="animeVideo" controls style="width:100%; max-height:60vh; background:#000; border-radius:8px;"></video>
    <p style="margin-top:10px; font-size:0.9em; color:var(--text-light);">
      <a href="${e}" target="_blank" rel="noopener noreferrer">Open video in new tab</a> | 
      <a href="#" onclick="location.reload(); return false;">Refresh player</a>
    </p>
  `;const s=document.getElementById("animeVideo");if(s.canPlayType("application/vnd.apple.mpegurl")){s.src=e,s.play().catch(t=>{console.warn("Auto-play prevented:",t)});return}try{if(window.Hls||await new Promise((t,o)=>{const i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12/dist/hls.min.js",i.onload=t,i.onerror=()=>o(new Error("Failed to load HLS.js")),document.head.appendChild(i)}),window.Hls){const t=new window.Hls({enableWorker:!0,lowLatencyMode:!0});t.loadSource(e),t.attachMedia(s),t.on(window.Hls.Events.MANIFEST_PARSED,()=>{s.play().catch(o=>{console.warn("Auto-play prevented:",o)})}),t.on(window.Hls.Events.ERROR,(o,i)=>{if(console.error("HLS error:",i),i.fatal)switch(i.type){case window.Hls.ErrorTypes.NETWORK_ERROR:t.startLoad();break;case window.Hls.ErrorTypes.MEDIA_ERROR:t.recoverMediaError();break;default:window.open(e,"_blank");return}});return}}catch(t){console.warn("HLS playback failed:",t)}window.open(e,"_blank")};N.addEventListener("click",U);P.addEventListener("keypress",e=>{e.key==="Enter"&&U()});H.addEventListener("change",()=>{L.innerHTML="",$.innerHTML="",T.innerHTML="",f.innerHTML=""});$.innerHTML=`
  <div style="text-align:center; padding:40px;">
    <h2>Welcome to AnimeFlix! ðŸŽŒ</h2>
    <p style="margin-top:20px;">Search for your favorite anime above to get started.</p>
    <p style="color:var(--text-light); margin-top:10px;">Select a provider from the dropdown and enter a search term.</p>
  </div>
`;
